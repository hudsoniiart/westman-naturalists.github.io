---
title: "Events"
---

::::{.columns}


:::{.column width=50%}
There is so much to see and do in this corner of Manitoba!

Events range from casual walks through city parks, to bird watching along rivers and wetlands, to public talks by local experts.

Enjoy!

<!-- ### Spring 2024 Update {.notice} -->
<!-- Talks are on hold for the summer and we're resuming outings! -->

:::
:::{.column width=50%}
![](images/DSC_5760 (2).JPG){fig-align="right" fig-alt="Pink cactus blooming"}
:::
::::



<!-- 
**Westman Naturalists are venturing outside!**

We will follow current public health guidelines for all our outings, please assess the risks based on your own situation. For more details please see [our protocols](resources.html). We are limiting groups to a maximum of 15, so sign-up is required for each outing.  We have listed a few outings below, and will add more. We are also looking into additional webinar presentations. -->

### Upcoming Events

::::{.columns}
:::{.column}
Everyone is welcome to join in on any and every event!

Please remember to dress for the weather, bring water and bug spray, and food for outings.
:::

:::{.column}
<div style="float: right; clear: right">
<iframe src="https://calendar.google.com/calendar/embed?height=300&wkst=1&bgcolor=%23c49a00&ctz=America%2FWinnipeg&showTitle=0&showDate=1&showPrint=0&showCalendars=0&showTabs=1&src=d2VzdG1hbi5uYXR1cmFsaXN0c0BnbWFpbC5jb20&color=%23039BE5" style="border:solid 1px #777" width="350" height="250" frameborder="0" scrolling="no"></iframe></div>
:::
::::

```{r}
#| message = FALSE,
#| warning = FALSE,
#| echo = FALSE
library(dplyr)
library(stringr)
library(tidyr)
library(purrr)
library(lubridate)
library(glue)
library(janitor)
library(googlesheets4)

gs4_deauth()

events <- gs4_get("https://docs.google.com/spreadsheets/d/132krSjS7w574gavkX31XxmcmmafXbC-zfM81W2mDXAY/") |>
  read_sheet() |>
  clean_names() |>
  select(-advertised, -calendar) |>
  mutate(across(c("tentative", "remote_speaker"), \(x) {
    x <- tolower(x) == "yes"
    replace_na(x, FALSE)
  })) |>
  mutate(month = month(date),
         year = year(date),
         date = as_date(date),
         date_pretty = if_else(tentative, "%b %Y", "%A, %b %d %Y"),
         date_pretty = format(date, date_pretty),
         time = map(time, as.character),
         speaker = if_else(is.na(speaker) | speaker == "", "The Speaker", speaker)) |>
  mutate(time = map(time, ~replace(.x, length(.x) == 0, "All day"))) |>
  unnest(cols = "time") |>
  mutate(time = if_else(str_detect(time, "[0-9]{4}-[0-9]{2}"), 
                        format(suppressWarnings(as_datetime(time)), "%I:%M %p"), 
                        time)) |>
  mutate(
    past = date < Sys.Date(),
    past = replace_na(past, FALSE),
    time = str_remove(time, "^0"),
    description = str_replace_all(description, 
                                  "westman.naturalists@gmail.com", 
                                  "[westman.naturalists@gmail.com](mailto:westman.naturalists@gmail.com)"),
    description = str_replace(description, regex("(Trip difficulty)", ignore_case = TRUE), "**\\1**"),
    extra = if_else(extra != "", glue("<div class = 'notice'>\n\n{extra}\n\n</div>"), ""),
    cancelled = str_detect(tolower(description), regex("cancelled", ignore_case = TRUE)),
    
    status = if_else(cancelled, "**<span class='notice'>Cancelled</span>** ", ""),
    hosted = replace_na(hosted, "Westman Naturalists"),
    talk = "This is a hybrid event!",
    talk = if_else(remote_speaker, 
                   glue("{talk} {speaker} will be joining us via Zoom, but we'll still be meeting in person!"), 
                   "{talk}"),
    talk = glue("{talk} Feel free to come in person to"),
    talk = if_else(remote_speaker, 
                   glue("{talk} socialize with your fellow Westman Naturalists"), 
                   glue("{talk} meet {speaker}")),
    talk = glue("{talk} and see the talk, or join us via Zoom.<br>",
                "To join us via Zoom, please complete and submit this [short form]({form}) to sign-up. ",
                "We will email out the Zoom link the evening of the talk."),
    outing = glue("Please complete this [short form]({form}) to sign-up for this event. ",
                  "We will email you with specific details a day or so before the event. ",
                  "Car pooling might be available."),
    outing = case_when(
      is.na(form) ~ "No sign up is required for this event, though there will be a waiver to sign.", 
      form == tolower("TBA") ~ "Further details to come",
      .default = outing),
    form = case_when(!is.na(form) & !str_detect(form, "^http") ~ form,
                     hosted != "Westman Naturalists" ~ "",
                     type == "talk" ~ talk,
                     type == "outing" ~ outing),
    footer = if_else(str_detect(hosted, "Westman Naturalists"), 
                     "[Contact Westman Naturalists for more information](mailto:westman.naturalists@gmail.com)",
                     "Note that this event is not hosted by Westman Naturalists"),
    footer = if_else(past, "", footer),
    hosted = glue("Hosted by {hosted}"),
    location = if_else(is.na(location) & type == "talk", "Brodie Building Rm 3-47, Brandon University & Online", location),
    form = glue("**Participation**: {form}"),
    form = if_else(past, "", form),
    event = glue("{extra}\n\n",
                 "{status}<span class = 'date'>{date_pretty}</span>\n\n",
                 "<span class = 'event-title'>{title}</span> {hosted}\n\n",
                 "{description}\n\n", 
                 "{form}\n\n",
                 "**Time**: {time}<br>",
                 "**Location**: {location}\n\n",
                 "{footer}", .na = ""),
    facebook = if_else(!is.na(facebook), 
                       glue("[![<a href=\"{link}\">Link to summary on Facebook</a>]({facebook}){{width=\"50%\" fig-alt=\"A picture from facebook about the event\"}}]({link})"),
                       ""))

if(any(is.na(events$time))) stop("Problems with Time", call. = FALSE)
```

```{r}
#| echo = FALSE,
#| results = "asis"
upcoming <- filter(events, !past) |>
  arrange(date) |>
  nest(data = c(-month))

if(nrow(upcoming) == 0){
  cat("> **Nothing planned at the moment, but check back!**")

} else {
  for(m in upcoming$month) {
    print(glue("\n\n## ", as.character(month(m, label = TRUE, abbr = FALSE)), "\n\n"))
    
    filter(upcoming, month == m) |>
      unnest(cols = data) |>
      pull(event) |>
      glue_collapse(sep = "\n\n-----\n\n") |>
      print()
  }
}
```


--------

### Previous Events
```{r}
#| echo = FALSE,
#| results = "asis"
past <- filter(events, past) |>
  arrange(desc(date)) |>
  nest(data = c(-year, -month))

cat(":::{.panel-tabset}\n\n")

for(y in unique(past$year)) {
  cat(glue("\n\n#### {y}\n\n"))
  
  p <- filter(past, year == y)
  for(i in seq_len(nrow(p))) {
    m <- p$month[i]
    
    print(glue("\n\n## {as.character(month(m, label = TRUE, abbr = FALSE))} {y}\n\n"))
    
    p[i, ] |>
      unnest(cols = data) |>
      mutate(event = glue("{event}\n\n{facebook}")) |>
      pull(event) |>
      glue_collapse(sep = "\n\n-----\n\n") |>
      print()
  }
}
cat("\n\n:::\n\n")
```

